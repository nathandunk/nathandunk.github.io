<!DOCTYPE html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <title>FES C++ UART Interface Library - Nathan Dunkelberger</title>
    <link href="../assets/css/main.css" rel="stylesheet">
    <link href="../assets/css/custom.css" rel="stylesheet">
    <link rel="icon" type="image/png" href="/img/logo.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.0.0/animate.min.css"/>
</head>
<body onload="onStartup()">
<!-- Sidebar -->
<nav id="sidebar">
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">Ã—</a>
    <div style="margin:auto">
        <img src="/img/headshot_brick.jpg" width="200" id="sidebarimg">
    </div>
    <div class="sidebar-header">
        <h4><a href="/">Nathan Dunkelberger</a></h4>
    </div>

    <p id="description-text">
        I am a Robotics Engineer working on the Dexterous Robotics team at NASA Johnson Space Center researching the next generation of space robotics.    </p>

    <ul class="list-unstyled">
        
           
        <li><a href="/Research/" class="page-list">Research</a></li>
             
        <li><a href="/AboutMe/" class="page-list">About Me</a></li>
             
        <li><a href="/Portfolio/" class="page-list">Portfolio</a></li>
               
        <li><a href="/" class="page-list">Home</a></li>
              
    </ul>

    <!-- <ul class="list-unstyled">
        <li class="my-1"><a class="btn btn-light btn-sm sidebar-social-btn py-1" role="button" href="https://github.com/nathandunk" target="_blank"><img src="/img/icons/GitHub_Logo.png" class="sidebar-social-img py-auto"></a></li>
        <li class="my-1"><a class="btn btn-light btn-sm sidebar-social-btn py-1" role="button" href="https://www.linkedin.com/in/nathan-dunkelberger-b5a00382/" target="_blank"><img src="/img/icons/LI-Logo.png" class="sidebar-social-img"></a></li>
    </ul> -->
    <ul class="list-unstyled">
        <li class="my-1">
            <a href="https://www.linkedin.com/in/nathan-dunkelberger-b5a00382/"><img src="/img/icons/linkedin-3-128.png" style="vertical-align:middle;" height=18px> <span style="vertical-align:middle;">Linkedin</span></a>
        </li>

        <li class="my-1">
            <a href="https://github.com/nathandunk"> <img src="/img/icons/GitHub-Mark-Light-32px.png" style="vertical-align:middle;" height=18px> <span style="vertical-align:middle;">Github</span></a>
        </li>
        <li class="my-1">
            <a href="/files/NathanDunkelbergerCV.pdf"> <img src="/img/icons/document_icon.png" style="vertical-align:middle;" height=18px> <span style="vertical-align:middle;">CV</span></a>
        </li>
    </ul>
    <!-- <div id="sidebar-social-center">
        <a class="btn btn-light btn-sm sidebar-social-btn py-0" role="button" href="https://github.com/nathandunk" target="_blank"><img src="/img/icons/GitHub_Logo.png" class="sidebar-social-img"></a>
        <a class="btn btn-light btn-sm sidebar-social-btn py-0" role="button" href="https://www.linkedin.com/in/nathan-dunkelberger-b5a00382/" target="_blank"><img src="/img/icons/LI-Logo.png" class="sidebar-social-img"></a>
    </div> -->
</nav>

<script>
    function closeNav() {
        document.getElementById("sidebar").style.marginLeft = "-280px";
        document.getElementById("content-with-sidebar").style.marginLeft = "36px";
        document.getElementById("content-with-sidebar").style.marginRight = "36px";
        document.getElementById("content-with-sidebar").style.marginTop = "0px";
        var collapse_element = document.getElementById("sidebarCollapse");
        var background_element = document.getElementById("button-background");
        collapse_element.classList.remove("d-none");
        background_element.classList.remove("d-none");
        console.log("closing");
    }
    function openNav() {
        document.getElementById("sidebar").style.marginLeft = "0px";
        document.getElementById("content-with-sidebar").style.marginLeft = "280px";
        document.getElementById("content-with-sidebar").style.marginRight = "0px";
        document.getElementById("content-with-sidebar").style.marginTop = "0";
        var collapse_element = document.getElementById("sidebarCollapse");
        var background_element = document.getElementById("button-background");
        collapse_element.classList.add("d-none");
        background_element.classList.add("d-none");
        console.log("opening");
    }
    function onStartup() {
        const mq = window.matchMedia( "(max-width: 768px)" );
        if (mq.matches) {
            console.log("Small");    
            closeNav();
        } else {
            console.log("Large");
            openNav();
        }
    }
</script>
 <!-- <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="#">Logo</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
      <div class="navbar-nav">
        
        <a class="nav-item nav-link" href="/">Home</a>
        
        <a class="nav-item nav-link" href="/about">About</a>
          
      </div>
    </div>
  </nav> -->
  <div id="content-with-sidebar">
    <!-- <div id="button-background"> -->
      <button type="button" onclick="openNav()" class="btn btn-outline-dark d-none" id="sidebarCollapse">
        <i class="fas fa-bars"></i>
      </button>
    <!-- </div> -->
    
    <section id="project">
  <div class="container content-section"> 
      <div class="row"> 
       <div class="clearfix"></div>
         <div class="col">
            </br><p><a href="/Portfolio">Back to Portfolio Home</a></p>
            <p><strong>Summary</strong> - I created a high-level C++ library to interface with a research-grade UART-based FES control system. The instruction for device communication explain the low-level UART control for very fine-grained functionality, but I wanted an interface that was human-readable and easily adjusted, so I made a high-level C++ library that has intitive functions like stim.set_amp(), stim.set_pw(), etc.</p>
            <h1 id="high-level-c-fes-library">High-level C++ FES Library</h1>
<p>I developed <a href="https://github.com/mahilab/mahi-fes">a library</a> to run a research-grade Functional Electrical Stimulator System based on low-level UART control. This library facilitated my easy use of FES for coordinated use with the exoskeleton I am using to assist arm movements. One main feature of the library is a GUI that displays the current status of FES channels if being controlled externally, or allows for the direct control if desired. An example of the GUI is shown below.</p>

<p><img src="/img/visualizer.gif" alt="Visualizer" /></p>

<p>A full set of examples for how to use the library is shown <a href="https://github.com/mahilab/mahi-fes/tree/master/examples">here</a>, but see below for some examples of improvements.</p>

<p>The example code for how to control the simulator included a lot of code like the example below.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span><span class="p">(</span><span class="n">new_time</span> <span class="o">-</span> <span class="n">old_time</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">){</span>
    <span class="n">chngevnt1</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">open_loop</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="n">chngevnt1</span><span class="p">[(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">chngevnt1</span><span class="p">)</span> <span class="o">/</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">chngevnt1</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">checksum</span><span class="p">(</span><span class="n">chngevnt1</span><span class="p">,</span> <span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">chngevnt1</span><span class="p">)</span> <span class="o">/</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">chngevnt1</span><span class="p">)));</span>
    <span class="n">write</span><span class="p">(</span><span class="n">fd0</span><span class="p">,</span> <span class="n">chngevnt1</span><span class="p">,</span> <span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">chngevnt1</span><span class="p">)</span> <span class="o">/</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">chngevnt1</span><span class="p">)));</span>		
    <span class="n">old_time</span> <span class="o">=</span> <span class="n">new_time</span><span class="p">;</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>My goal was to make a library that was much more human-readable and easily configurable. A similar control loop using my library looks like the following.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">stop</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// update the pulsewidth of each of the stimulation events</span>
    <span class="n">stim</span><span class="p">.</span><span class="n">set_amp</span><span class="p">(</span><span class="n">bicep</span><span class="p">,</span> <span class="mi">60</span><span class="p">);</span>
    <span class="n">stim</span><span class="p">.</span><span class="n">write_pw</span><span class="p">(</span><span class="n">bicep</span><span class="p">,</span> <span class="mi">10</span> <span class="o">+</span> <span class="kt">int</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)));</span>

    <span class="c1">// command the stimulation patterns to be sent to the stim board.</span>
    <span class="c1">// This is required whether using the gui or updating in code.</span>
    <span class="n">test_clock</span><span class="p">.</span><span class="n">restart</span><span class="p">();</span>
    <span class="n">stim</span><span class="p">.</span><span class="n">update</span><span class="p">();</span>
    <span class="c1">// wait for the loop to end</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">timer</span><span class="p">.</span><span class="n">wait</span><span class="p">().</span><span class="n">as_seconds</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

          </div>
      </div> 
   </div>
</section>
  </div>
<!-- JS -->
<script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js" integrity="sha384-SlE991lGASHoBfWbelyBPLsUlwY1GwNDJo3jSJO04KZ33K2bwfV9YBauFfnzvynJ" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
</body>
</html>